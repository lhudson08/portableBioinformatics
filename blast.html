<html>
  <head>
    <title>htmlBio BLAST</title>
    <link rel="stylesheet" type="text/css" href="css/reset.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <script src="lib/jquery-2.1.4.min.js"></script>
    <!--
    <script src="lib/NtSeq/lib/nt.js"></script>
    <script src="lib/bio-js-LK/src/Bio.js"></script>
    -->
    <script>
	
	$(document).ready(function(){
      $("#QUERY").change(function(event){
	    var querySeq=loadSeq(event);
	    event.preventDefault();
	  });
	  
	  amReady();
	});
    function loadSeq(event){
	  amBusy();
	  var targetEl=event.currentTarget
	  var filename=targetEl.value
	  var file=targetEl.files[0]
	  
	  containerEl=$("#"+targetEl.id+"_container");
	  
	  var fr=new FileReader();
	  fr.onload=function(e){
	    var fileContent=e.target.result
        containerEl.html(fileContent);
        console.log(fileContent.substr(0,100) + "...");
        amReady();
      }
      fr.readAsText(file)
	}
	
	var busyCounter=1; // 0 when not busy; document.ready will decrease this to 0
	function amReady(){
	  busyCounter--;
	  if(busyCounter<1){
	    $("#ready").css('background-color',"#77FF77");
	  }
	}
	function amBusy(){
	  busyCounter++;
	  if(busyCounter >=1 ){
	    $("#ready").css('background-color',"#FF7777");
	  }
	}
    </script>
  </head>  
  <body>
    <div>
      <span id="ready" style="height:20px;width:20px;padding:5">&nbsp;</span>
      <p>
	    <input type="file" class="seqFile" name="QUERY" id="QUERY" />
        <div class="hidden" id="QUERY_container"></div>
      </p>
    </div>
  </body>
 
</html>
